<!DOCTYPE html>
<html lang="en">
  
  <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-147535443-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-147535443-1');
    </script>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LambdaSharp.App.EventBus - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta name="description" content="Documentation for LambdaSharp.App.EventBus module">
    <meta name="keywords" content="module, app, event bus, documentation, overview, lambdasharp, lambda sharp, aws, serverless, .net, dotnet, .net core, dotnetcore, c#, c sharp">
    <meta name="generator" content="docfx 2.59.0.0">
    <meta name="robots" content="index,follow">
  
    <meta property="og:title" content="LambdaSharp.App.EventBus - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta property="og:site_name" content="LambdaSharp - Serverless .NET for AWS">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en_US">
    <meta property="og:url" content="https://lambdasharp.net/modules/LambdaSharp-App-EventBus.html">
    <meta property="og:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
    <meta property="og:description" content="Documentation for LambdaSharp.App.EventBus module">
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LambdaSharp.App.EventBus - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta name="twitter:site" content="@lambdasharp">
    <meta name="twitter:description" content="Documentation for LambdaSharp.App.EventBus module">
    <meta name="twitter:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
  
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
  
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:newtab" content="true">
  
    <title>LambdaSharp.App.EventBus - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS </title>
    <link rel="canonical" href="https://lambdasharp.net/modules/LambdaSharp-App-EventBus.html">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/LambdaSharpLogo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="module-lambdasharpappeventbus">Module: LambdaSharp.App.EventBus</h1>

<p><em>Version:</em> 0.8.3.5</p>
<h2 id="overview">Overview</h2>
<p>The <em>LambdaSharp.App.EventBus</em> module is used by the <code>App</code> declaration to create an API Gateway WebSocket proxy for CloudWatch EventBridge. The proxy is only created if the app has at least one event source. When created, the proxy manages event pattern subscriptions to forwarded events. The proxy uses the same notation as CloudWatch EventBridge to describe event patterns. This design promotes a unified way to work with CloudWatch events both in the backend and frontend. Access to the EventBus API is secured by an API key that is computed from the CloudFormation stack identifier and the app version identifier. Using the <code>DevMode</code> parameter, the EventBus API can be configured for more lenient access and a simplified API key, which allows for accessing it from <em>localhost</em>.</p>
<h2 id="resource-types">Resource Types</h2>
<p>This module defines no resource types.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><code>AppVersionId</code></dt>
<dd>
<p>The <code>AppVersionId</code> parameter specifies the app version identifier. This value is used to construct the complete API key.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>DevMode</code></dt>
<dd>
<p>The <code>DevMode</code> parameter specifies if the app EventBus API should run with relaxed API key constraints and enables debug logging. The value must be one of <code>Enabled</code> or <code>Disabled</code>. Default value is <code>Disabled</code>.</p>
<p><i>Required</i>: No</p>
<p><i>Type:</i> String</p>
<p>The <code>DevMode</code> parameter must have one of the following values:</p>
<dl>
<dt><code>Disabled</code></dt>
<dd>
<p>The API key is based on teh CloudFormation stack identifier and the app version identifier. Debug logging is disabled in the app.</p>
</dd>
</dl>
</dd>
<dt><code>Enabled</code></dt>
<dd>
<p>The API key is solely based on the CloudFormation stack identifer. Debug logging is enabled in the app.</p>
</dd>
</dl>
<h2 id="output-values">Output Values</h2>
<dl>
<dt><code>ApiKey</code></dt>
<dd>
<p>The <code>ApiKey</code> output contains the CloudFormation stack identifier portion of the API key.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>EventTopicArn</code></dt>
<dd>
<p>The <code>EventTopicArn</code> output contains the SNS topic ARN for broadcasting events to the app event bus.</p>
<p><i>Type:</i> AWS::SNS::Topic</p>
</dd>
<dt><code>Url</code></dt>
<dd>
<p>The <code>Url</code> output contains the URL of the api endpoint used by the <code>LambdaSharpEventBusClient</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>WebSocketApiId</code></dt>
<dd>
<p>The <code>WebSocketApiId</code> output contains the ID of the WebSocket API.</p>
<p><i>Type:</i> AWS::ApiGatewayV2::Api</p>
</dd>
</dl>
<h2 id="websocket-api">WebSocket API</h2>
<p>The WebSocket API endpoint can be found in the <code>Url</code> output value of the nested stack. The WebSocket API manages the broadcasting of subscribed EventBridge events to clients. Each client can have an arbitrary number of subscription rules using the <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/filtering-examples-structure.html">EventBridge pattern</a> notation.</p>
<p>Note that events must first be published to WebSocket SNS topic before they can be subscribed to. The ARN of the SNS topic can be found in the <code>EventTopicArn</code> output value of the nested stack.</p>
<h3 id="authentication">Authentication</h3>
<p>The WebSocket API expects a <code>header</code> query parameter in the request to validate access to the API. The value of the <code>header</code> query parameter is a base64 encoded JSON document.</p>
<h4 id="header-document">Header Document</h4>
<pre><code class="lang-json">{
    &quot;Host&quot;: &quot;string&quot;,
    &quot;ApiKey&quot;: &quot;string&quot;,
    &quot;Id&quot;: &quot;guid&quot;
}
</code></pre>
<h4 id="header-properties">Header Properties</h4>
<dl>
<dt><code>Host</code></dt>
<dd>
<p>The WebSocket domain name.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>ApiKey</code></dt>
<dd>
<p>The API key to authorize access to the WebSocket. The API key is computed by concatenating <code>AppVersionId</code> with the colon character (i.e. <code>':'</code>) and the CloudFormation stack identifier, and then applying a base 64 encoding to the result. When <code>DevMode</code> is enabled, the API key only uses the CloudFormation stack identifier.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Id</code></dt>
<dd>
<p>The app instance ID or session ID. Must be a unique GUID.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> GUID</p>
</dd>
</dl>
<h4 id="sample-header-encoding">Sample Header Encoding</h4>
<p>The following example illustrates how to encode the JSON header into a query parameter.</p>
<p><strong>Original header document:</strong></p>
<pre><code class="lang-json">{
    &quot;Host&quot;: &quot;acme.execute-api.us-west-2.amazonaws.com&quot;,
    &quot;ApiKey&quot;: &quot;ZWU4OTc0MjAtODgzNi0xMWViLWFmMmMtMDIxZTQ5Njc5YTBi&quot;,
    &quot;Id&quot;: &quot;4a114560-fa5b-4f94-a462-69fbaf432b86&quot;
}
</code></pre>
<p><strong>Encoded header value:</strong></p>
<pre><code>wss://acme.execute-api.us-west-2.amazonaws.com/LATEST/?header=ewogICAgIkhvc3QiOiAiYWNtZS5leGVjdXRlLWFwaS51cy13ZXN0LTIuYW1hem9uYXdzLmNvbSIsCiAgICAiQXBpS2V5IjogIlpXVTRPVGMwTWpBdE9EZ3pOaTB4TVdWaUxXRm1NbU10TURJeFpUUTVOamM1WVRCaSIsCiAgICAiSWQiOiAiNGExMTQ1NjAtZmE1Yi00Zjk0LWE0NjItNjlmYmFmNDMyYjg2Igp9Cg==
</code></pre>
<h3 id="protocol">Protocol</h3>
<p>The WebSocket protocol has two types of interactions: actions and notifications. <em>Actions</em> are similar to requests in that each action has exactly one response, called acknowledgements. <em>Acknowledgements</em> are correlated to actions by the <code>RequestId</code> property. <em>Notifications</em> can occur at any time and are commonly  triggered by a subscription rule.</p>
<h3 id="action-syntax">Action Syntax</h3>
<p>Each request must have a <code>Action</code> property with a known value. The <code>Action</code> property indicates the shape of the request. In addition, must have a <code>RequestId</code> property to correlate responses from the WebSocket with their requests.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;string&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;
}
</code></pre>
<h4 id="properties">Properties</h4>
<p>The following properties are required for all requests.</p>
<dl>
<dt><code>Action</code></dt>
<dd>
<p>The name of the action to invoke.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RequestId</code></dt>
<dd>
<p>The unique identifier for the request.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> GUID</p>
</dd>
</dl>
<h4 id="acknowledge-success">Acknowledge: Success</h4>
<p>A response to an action has <code>Ack</code> as its <code>Action</code> value. The <code>RequestId</code> must be used to correlate a response to an earlier request. The order in which responses are sent back is non-deterministic and the client must be able to associate responses correctly to pending requests.</p>
<p>A successful acknowledge response has <code>Ok</code> as its <code>Status</code> value.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;Ack&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;,
    &quot;Status&quot;: &quot;Ok&quot;
}
</code></pre>
<dl>
<dt><code>Action</code></dt>
<dd>
<p>The value is always <code>Ack</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RequestId</code></dt>
<dd>
<p>The unique identifier for the request correlating it to a matching <em>Action</em>.</p>
<p><i>Type:</i> GUID</p>
</dd>
<dt><code>Status</code></dt>
<dd>
<p>The value is always <code>Ok</code>.</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<h4 id="acknowledge-error">Acknowledge: Error</h4>
<p>A response to an action has <code>Ack</code> as its <code>Action</code> value. The <code>RequestId</code> must be used to correlate a response to an earlier request. The order in which responses are sent back is non-deterministic and the client must be able to associate responses correctly to pending requests.</p>
<p>A failed acknowledge response has <code>Error</code> as its <code>Status</code> value. In addition, the <code>Message</code> property contains a description of the error.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;Ack&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;,
    &quot;Status&quot;: &quot;Error&quot;,
    &quot;Message&quot;: &quot;string&quot;
}
</code></pre>
<dl>
<dt><code>Action</code></dt>
<dd>
<p>The value is always <code>Ack</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Message</code></dt>
<dd>
<p>A description of the error that occurred.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RequestId</code></dt>
<dd>
<p>The unique identifier for the request correlating it to a matching <em>Action</em>.</p>
<p><i>Type:</i> GUID</p>
</dd>
<dt><code>Status</code></dt>
<dd>
<p>The value is always <code>Error</code>.</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<h3 id="action-hello">Action: Hello</h3>
<p>The <code>Hello</code> action must be sent by the client as soon as the connection is opened. Failure to send the <code>Hello</code> action will cause the connection to be automatically closed by the WebSocket API.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;Hello&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;
}
</code></pre>
<h3 id="action-subscribe">Action: Subscribe</h3>
<p>The <code>Subscribe</code> action is used to create or update a subscription rule. The subscription rule has an <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/filtering-examples-structure.html">EventBridge pattern</a> to describe which events should be sent to the client.</p>
<p>Note that only events published to the <code>EventTopicArn</code> SNS topic can be subscribed to.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;Subscribe&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;,
    &quot;Rule&quot;: &quot;string&quot;,
    &quot;Pattern&quot;: &quot;pattern&quot;
}
</code></pre>
<h4 id="properties-1">Properties</h4>
<p>The following properties are in addition to the default request properties.</p>
<dl>
<dt><code>Rule</code></dt>
<dd>
<p>The name of the subscription rule to create or update.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Pattern</code></dt>
<dd>
<p>The <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/filtering-examples-structure.html">EventBridge pattern</a> describing the events to subscribe to.</p>
<p>Note that only events published to the <code>EventTopicArn</code> SNS topic can be subscribed to.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/filtering-examples-structure.html">EventBridge pattern</a> as a JSON string</p>
</dd>
</dl>
<h3 id="action-unsubscribe">Action: Unsubscribe</h3>
<p>The <code>Unsubscribe</code> action is used to delete a subscription rule.</p>
<pre><code class="lang-json">{
    &quot;Action&quot;: &quot;Unsubscribe&quot;,
    &quot;RequestId&quot;: &quot;guid&quot;,
    &quot;Rule&quot;: &quot;string&quot;
}
</code></pre>
<h4 id="properties-2">Properties</h4>
<p>The following properties are in addition to the default request properties.</p>
<dl>
<dt><code>Rule</code></dt>
<dd>
<p>The name of the subscription rule to delete.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<h3 id="notification-event">Notification: Event</h3>
<p>An event notification has <code>Event</code> as its <code>Action</code> value. The WebSocket API sends this notification when an EventBridge event published to <code>EventTopicArn</code> matches one or more subscription rules.</p>
<pre><code class="lang-json">{
  &quot;Action&quot;: &quot;Event&quot;,
  &quot;Rules&quot;: [ &quot;string&quot; ],
  &quot;Source&quot;: &quot;string&quot;,
  &quot;Type&quot;: &quot;string&quot;,
  &quot;Event&quot;: &quot;json&quot;,
  &quot;RequestId&quot;: &quot;guid&quot;
}
</code></pre>
<h4 id="properties-3">Properties</h4>
<dl>
<dt><code>Action</code></dt>
<dd>
<p>The value is always <code>Event</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Event</code></dt>
<dd>
<p>The <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/aws-events.html">EventBridge event</a> payload that matched the subscription rule.</p>
<p><i>Type:</i> <a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/aws-events.html">EventBridge event</a> as a JSON string</p>
</dd>
<dt><code>RequestId</code></dt>
<dd>
<p>The unique identifier for the request.</p>
<p><i>Type:</i> GUID</p>
</dd>
<dt><code>Rules</code></dt>
<dd>
<p>A list of subscription rules that were matched by the event.</p>
<p><i>Type:</i> List of String</p>
</dd>
<dt><code>Source</code></dt>
<dd>
<p>The value of the <code>source</code> property from the EventBridge event.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Type</code></dt>
<dd>
<p>The value of the <code>detail-type</code> property from the EventBridge event.</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<p><strong>Sample EventBridge event:</strong></p>
<pre><code class="lang-json">{
  &quot;version&quot;: &quot;0&quot;,
  &quot;id&quot;: &quot;6a7e8feb-b491-4cf7-a9f1-bf3703467718&quot;,
  &quot;detail-type&quot;: &quot;EC2 Instance State-change Notification&quot;,
  &quot;source&quot;: &quot;aws.ec2&quot;,
  &quot;account&quot;: &quot;111122223333&quot;,
  &quot;time&quot;: &quot;2017-12-22T18:43:48Z&quot;,
  &quot;region&quot;: &quot;us-west-1&quot;,
  &quot;resources&quot;: [
    &quot;arn:aws:ec2:us-west-1:123456789012:instance/i-1234567890abcdef0&quot;
  ],
  &quot;detail&quot;: {
    &quot;instance-id&quot;: &quot;i-1234567890abcdef0&quot;,
    &quot;state&quot;: &quot;terminated&quot;
  }
}
</code></pre>
<h3 id="notification-keepalive">Notification: KeepAlive</h3>
<p>A keep-alive notification has <code>KeepAlive</code> as its <code>Action</code> value. The WebSocket API sends this notification periodically to keep the WebSocket connection alive.</p>
<pre><code class="lang-json">{
  &quot;Action&quot;: &quot;KeepAlive&quot;,
  &quot;RequestId&quot;: &quot;guid&quot;
}
</code></pre>
<dl>
<dt><code>Action</code></dt>
<dd>
<p>The value is always <code>KeepAlive</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RequestId</code></dt>
<dd>
<p>The unique identifier for the request.</p>
<p><i>Type:</i> GUID</p>
</dd>
</dl>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
