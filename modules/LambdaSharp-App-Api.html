<!DOCTYPE html>
<html lang="en">
  
  <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-147535443-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-147535443-1');
    </script>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LambdaSharp.App.Api - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta name="description" content="Documentation for LambdaSharp.App.Api module">
    <meta name="keywords" content="module, app, api, documentation, overview, lambdasharp, lambda sharp, aws, serverless, .net, dotnet, .net core, dotnetcore, c#, c sharp">
    <meta name="generator" content="docfx 2.56.6.0">
    <meta name="robots" content="index,follow">
  
    <meta property="og:title" content="LambdaSharp.App.Api - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta property="og:site_name" content="LambdaSharp - Serverless .NET for AWS">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en_US">
    <meta property="og:url" content="https://lambdasharp.net/modules/LambdaSharp-App-Api.html">
    <meta property="og:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
    <meta property="og:description" content="Documentation for LambdaSharp.App.Api module">
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LambdaSharp.App.Api - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS">
    <meta name="twitter:site" content="@lambdasharp">
    <meta name="twitter:description" content="Documentation for LambdaSharp.App.Api module">
    <meta name="twitter:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
  
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
  
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:newtab" content="true">
  
    <title>LambdaSharp.App.Api - LambdaSharp Module | LambdaSharp - Serverless .NET for AWS </title>
    <link rel="canonical" href="https://lambdasharp.net/modules/LambdaSharp-App-Api.html">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/LambdaSharpLogo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="module-lambdasharpappapi">Module: LambdaSharp.App.Api</h1>

<p><em>Version:</em> 0.8.3.4</p>
<h2 id="overview">Overview</h2>
<p>The <em>LambdaSharp.App.Api</em> module is used by the <code>App</code> declaration to create an API Gateway REST API proxy for CloudWatch Logs, Metrics, and Events that is used by the app. The API can be configured to limit access using the <code>CoreOrigin</code> parameter. Access to the API is secured by an API key that is computed from the CloudFormation stack identifier and the app version identifier. Using the <code>DevMode</code> parameter, the API can be configured for more lenient access and a simplified API key, which allows for accessing it from <em>localhost</em>.</p>
<h2 id="resource-types">Resource Types</h2>
<p>This module defines no resource types.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><code>ParentModuleId</code></dt>
<dd>
<p>The <code>ParentModuleId</code> parameter specifies the module ID of the parent stack.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>ParentModuleInfo</code></dt>
<dd>
<p>The <code>ParentModuleInfo</code> parameter specifies the module information of the parent stack.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>LogGroupName</code></dt>
<dd>
<p>The <code>LogGroupName</code> parameter specifies the name of CloudWatch LogGroup for the app.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RootPath</code></dt>
<dd>
<p>The <code>RootPath</code> parameter specifies the root path for app API. The root path must be a single path segment.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
<p><i>Pattern:</i> <code>^[a-zA-Z0-9._-]+$</code></p>
</dd>
<dt><code>CorsOrigin</code></dt>
<dd>
<p>The <code>CorsOrigin</code> parameter specifies the source URL that is allowed to invoke the API. The value must be <em>http://</em> or <em>https://</em> followed by a valid domain name in lowercase letters, or <code>*</code> to allow any domain.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
<p><i>Pattern:</i> <code>^&amp;#42;|https?://((?!-)[a-z0-9-]{1,63}(?&lt;!-).)+[a-z]{2,6}$</code></p>
</dd>
<dt><code>BurstLimit</code></dt>
<dd>
<p>The <code>BurstLimit</code> parameter specifies the maximum number of requests per second over a short period of time.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> Number</p>
<p><i>Value Constraints:</i> Minimum value of 10.</p>
</dd>
<dt><code>RateLimit</code></dt>
<dd>
<p>The <code>RateLimit</code> parameter specifies the maximum number of requests per second over a long period of time.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> Number</p>
<p><i>Value Constraints:</i> Minimum value of 10.</p>
</dd>
<dt><code>EventSource</code></dt>
<dd>
<p>The <code>EventSource</code> parameter specifies the 'Source' property override for app events. When empty, the 'Source' property is set by the app request.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>AppVersionId</code></dt>
<dd>
<p>The <code>AppVersionId</code> parameter specifies the app version identifier. This value is used to construct the complete API key.</p>
<p><i>Required</i>: Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>DevMode</code></dt>
<dd>
<p>The <code>DevMode</code> parameter specifies if the app API should run with relaxed API key constraints and enables debug logging. The value must be one of <code>Enabled</code> or <code>Disabled</code>. Default value is <code>Disabled</code>.</p>
<p><i>Required</i>: No</p>
<p><i>Type:</i> String</p>
<p>The <code>DevMode</code> parameter must have one of the following values:</p>
<dl>
<dt><code>Enabled</code></dt>
<dd>
<p>The API key is solely based on the CloudFormation stack identifer. Debug logging is enabled in the app.</p>
</dd>
<dt><code>Disabled</code></dt>
<dd>
<p>The API key is based on teh CloudFormation stack identifier and the app version identifier. Debug logging is disabled in the app.</p>
</dd>
</dl>
</dd>
</dl>
<h2 id="output-values">Output Values</h2>
<dl>
<dt><code>ApiKey</code></dt>
<dd>
<p>The <code>ApiKey</code> output contains the CloudFormation stack identifier portion of the API key.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Url</code></dt>
<dd>
<p>The <code>Url</code> output contains the URL of the api endpoint used by the <code>LambdaSharpAppClient</code>.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>DomainName</code></dt>
<dd>
<p>The <code>DomainName</code> output contains the domain name of the API Gateway instance.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>CloudFrontOriginPath</code></dt>
<dd>
<p>The <code>CloudFrontOriginPath</code> output contains the origin path required by a CloudFront distribution to front the API.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>CloudFrontPathPattern</code></dt>
<dd>
<p>The <code>CloudFrontPathPattern</code> output contains the path pattern required by a CloudFront distribution to front the API.</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>RootPath</code></dt>
<dd>
<p>The <code>RootPath</code> outputs contains the root path for the app API.</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<h2 id="rest-api">REST API</h2>
<p>The REST API endpoint can be found in the <code>Url</code> output value of the nested stack.</p>
<h3 id="authentication">Authentication</h3>
<p>The REST API expects a <code>X-Api-Key</code> header in the request to validate access to the API.</p>
<p>The API key is computed by concatenating <code>AppVersionId</code> with the colon character (i.e. <code>':'</code>) and the CloudFormation stack identifier, and then applying a base 64 encoding to the result. When <code>DevMode</code> is enabled, the API key only uses the CloudFormation stack identifier.</p>
<p>To compute the effective API key, base 64 decode the <code>ApiKey</code> output value and concatenate it to the app version identifier:</p>
<pre><code class="lang-javascript">Headers[&quot;X-Api-Key&quot;] = Base64Encode($AppVersionId + ':' + Base64Decode($ApiKey))
</code></pre>
<p>When <code>DevMode</code> is enabled, the effective API key becomes:</p>
<pre><code class="lang-javascript">Headers[&quot;X-Api-Key&quot;] = $ApiKey
</code></pre>
<p>By default, the <code>RootPath</code> parameter has value <code>.app</code>, but this can be customized by the <code>App</code> declaration.</p>
<h3 id="postrootpathlogs---create-log-stream">POST:/${RootPath}/logs - Create Log Stream</h3>
<p>Creates a new log stream in the app log group. A log stream is a sequence of log events that originate from an app instance.</p>
<p>There is no limit on the number of log streams that can be created. There is a limit of 50 requests-per-second on this operations, after which requests are throttled.</p>
<p>The log stream name must match the following guidelines:</p>
<ul>
<li>Log stream names must be unique within the log group.</li>
<li>Log stream names can be between 1 and 512 characters long.</li>
<li>The ':' (colon) and '*' (asterisk) characters are not allowed.</li>
</ul>
<h4 id="request-syntax">Request Syntax</h4>
<pre><code class="lang-json">{
   &quot;logStreamName&quot;: &quot;string&quot;
}
</code></pre>
<h4 id="request-parameters">Request Parameters</h4>
<p>The request accepts the following data in JSON format.</p>
<dl>
<dt><code>logStreamName</code></dt>
<dd>
<p>The name of the log stream.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
<p><i>Length Constraints:</i> Minimum length of 1. Maximum length of 512.</p>
<p><i>Pattern:</i> <code>[^:*]*</code></p>
</dd>
</dl>
<h4 id="success-response-http-status-code-200">Success Response (HTTP Status Code: 200)</h4>
<p>On success, the API responds with an empty JSON document.</p>
<pre><code class="lang-json">{ }
</code></pre>
<h4 id="bad-request-response-http-status-code-400">Bad Request Response (HTTP Status Code: 400)</h4>
<p>On a <em>Bad Request</em> response, the body contains a message describing why the request was rejected. Additional details can be found in the API logs when enabled.</p>
<p><strong>Example:</strong> request body is missing required fields</p>
<pre><code class="lang-json">{
    &quot;error&quot;: &quot;Invalid request body&quot;
}
</code></pre>
<p><strong>Example:</strong> request validation error</p>
<pre><code class="lang-json">{
  &quot;error&quot;: &quot;1 validation error detected: Value \'\' at \'logStreamName\' failed to satisfy constraint: Member must have length greater than or equal to 1&quot;
}
</code></pre>
<h4 id="internal-error-response-http-status-code-500">Internal Error Response (HTTP Status Code: 500)</h4>
<p>On an <em>Internal Error</em> response, the body contains a generic message. The actual reason can be found in the API logs when enabled.</p>
<pre><code class="lang-json">{
   &quot;error&quot;: &quot;Unexpected response from service.&quot;
}
</code></pre>
<h3 id="putrootpathlogs---put-log-messages">PUT:/${RootPath}/logs - Put Log Messages</h3>
<p>Uploads a batch of log messages to the specified log stream.</p>
<p>The request must include the sequence token obtained from the response of the previous call, unless it is the first request to a newly created log stream. Using the same <code>sequenceToken</code> twice within a narrow time period may cause both calls to be successful or one might be rejected.</p>
<p>The batch of events must satisfy the following constraints:</p>
<ul>
<li>The maximum batch size is 1,048,576 bytes. This size is calculated as the sum of all event messages in UTF-8, plus 26 bytes for each log event.</li>
<li>None of the log events in the batch can be more than 2 hours in the future.</li>
<li>None of the log events in the batch can be older than 14 days or older than the retention period of the log group.</li>
<li>The log events in the batch must be in chronological order by their timestamp. The timestamp is the time the event occurred, expressed as the number of milliseconds after Jan 1, 1970 00:00:00 UTC.</li>
<li>A batch of log events in a single request cannot span more than 24 hours. Otherwise, the operation fails.</li>
<li>The maximum number of log events in a batch is 10,000.</li>
<li>There is a quota of 5 requests per second per log stream. Additional requests are throttled. This quota cannot be changed.</li>
</ul>
<h4 id="request-syntax-1">Request Syntax</h4>
<pre><code class="lang-json">{
   &quot;logEvents&quot;: [
      {
         &quot;message&quot;: &quot;string&quot;,
         &quot;timestamp&quot;: number
      }
   ],
   &quot;logStreamName&quot;: &quot;string&quot;,
   &quot;sequenceToken&quot;: &quot;string&quot;
}
</code></pre>
<h4 id="request-parameters-1">Request Parameters</h4>
<p>The request accepts the following data in JSON format.</p>
<dl>
<dt><code>logEvents</code></dt>
<dd>
<p>The log events.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> Array of log event objects</p>
<p><i>Array Members:</i> Minimum number of 1 item. Maximum number of 10,000 items.</p>
<dl>
<dt><code>message</code></dt>
<dd>
<p>The raw event message.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
<p><i>Length Constraints:</i> Minimum length of 1.</p>
</dd>
<dt><code>timestamp</code></dt>
<dd>
<p>The time the event occurred, expressed as the number of milliseconds after Jan 1, 1970 00:00:00 UTC.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> Long</p>
<p><i>Valid Range:</i> Minimum value of 0.</p>
</dd>
</dl>
</dd>
<dt><code>logStreamName</code></dt>
<dd>
<p>The name of the log stream.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
<p><i>Length Constraints:</i> Minimum length of 1. Maximum length of 512.</p>
<p><i>Pattern:</i> <code>[^:*]*</code></p>
</dd>
<dt><code>sequenceToken</code></dt>
<dd>
<p>The sequence token obtained from the response of the previous call. An upload in a newly created log stream does not require a sequence token. Using the same <code>sequenceToken</code> twice within a narrow time period may cause both calls to be successful or one might be rejected.</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
<h4 id="success-response-http-status-code-200-1">Success Response (HTTP Status Code: 200)</h4>
<p>On success, the API responds with a JSON document containing the sequence token for the next request.</p>
<pre><code class="lang-json">{
  &quot;nextSequenceToken&quot;: &quot;49608818592289528730168753288679022865213175397425034930&quot;
}
</code></pre>
<h4 id="bad-request-response-http-status-code-400-1">Bad Request Response (HTTP Status Code: 400)</h4>
<p><strong>Example:</strong> request body is missing required fields</p>
<pre><code class="lang-json">{
    &quot;error&quot;: &quot;Invalid request body&quot;
}
</code></pre>
<p><strong>Example:</strong> request validation error</p>
<pre><code class="lang-json">{
  &quot;error&quot;: &quot;1 validation error detected: Value \'\' at \'logStreamName\' failed to satisfy constraint: Member must have length greater than or equal to 1&quot;
}
</code></pre>
<p><strong>Example:</strong> The <code>sequenceToken</code> field is either missing or reusing a previous token value</p>
<pre><code class="lang-json">{
  &quot;error&quot;: &quot;The given batch of log events has already been accepted. The next batch can be sent with sequenceToken: 49608818592289528730168753288679022865213175397425034930&quot;,
  &quot;nextSequenceToken&quot;: &quot;49608818592289528730168753288679022865213175397425034930&quot;
}
</code></pre>
<h4 id="internal-error-response-http-status-code-500-1">Internal Error Response (HTTP Status Code: 500)</h4>
<p>On an <em>Internal Error</em> response, the body contains a generic message. The actual reason can be found in the API logs when enabled.</p>
<pre><code class="lang-json">{
   &quot;error&quot;: &quot;Unexpected response from service.&quot;
}
</code></pre>
<h3 id="postrootpathevents---send-events">POST:/${RootPath}/events - Send Events</h3>
<p>Sends custom events to the default event bus in Amazon EventBridge so that they can be matched to rules.</p>
<h4 id="request-syntax-2">Request Syntax</h4>
<pre><code class="lang-json">{
   &quot;Entries&quot;: [
      {
         &quot;Detail&quot;: &quot;string&quot;,
         &quot;DetailType&quot;: &quot;string&quot;,
         &quot;Resources&quot;: [ &quot;string&quot; ],
         &quot;Source&quot;: &quot;string&quot;
      }
   ]
}
</code></pre>
<h4 id="request-parameters-2">Request Parameters</h4>
<p>The request accepts the following data in JSON format.</p>
<dl>
<dt><code>Entries</code></dt>
<dd>
<p>The entry that defines an event in your system. You can specify several parameters for the entry such as the source and type of the event, resources associated with the event, and so on.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> Array of event objects</p>
<p><i>Length Constraints:</i> Minimum length of 1. Maximum length of 512.</p>
<p><i>Pattern:</i> <code>[^:*]*</code></p>
<dl>
<dt><code>Detail</code></dt>
<dd>
<p>A valid JSON string. There is no other schema imposed. The JSON string may contain fields and nested subobjects.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>DetailType</code></dt>
<dd>
<p>Free-form string used to decide what fields to expect in the event detail.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
<dt><code>Resources</code></dt>
<dd>
<p>AWS resources, identified by Amazon Resource Name (ARN), which the event primarily concerns. Any number, including zero, may be present.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> Array of strings</p>
</dd>
<dt><code>Source</code></dt>
<dd>
<p>The source of the event.</p>
<p><i>Required:</i> Yes</p>
<p><i>Type:</i> String</p>
</dd>
</dl>
</dd>
</dl>
<h4 id="success-response-http-status-code-200-2">Success Response (HTTP Status Code: 200)</h4>
<p>On success, the events API responds with an empty JSON document.</p>
<pre><code class="lang-json">{ }
</code></pre>
<h4 id="internal-error-response-http-status-code-500-2">Internal Error Response (HTTP Status Code: 500)</h4>
<p>On an <em>Internal Error</em> response, the body contains a generic message. The actual reason can be found in the API Gateway logs when enabled.</p>
<pre><code class="lang-json">{
   &quot;error&quot;: &quot;Unexpected response from service.&quot;
}
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
