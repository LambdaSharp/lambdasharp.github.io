<!DOCTYPE html>
<html lang="en">
  
  <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-147535443-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-147535443-1');
    </script>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LambdaSharp &quot;Damo&quot; Release (v0.4) | LambdaSharp - Serverless .NET for AWS">
    <meta name="description" content="Release notes for LambdaSharp &quot;Damo&quot; (v0.4)">
    <meta name="keywords" content="release, notes, damo, lambdasharp, lambda sharp, aws, serverless, .net, dotnet, .net core, dotnetcore, c#, c sharp">
    <meta name="generator" content="docfx 2.58.4.0">
    <meta name="robots" content="index,follow">
  
    <meta property="og:title" content="LambdaSharp &quot;Damo&quot; Release (v0.4) | LambdaSharp - Serverless .NET for AWS">
    <meta property="og:site_name" content="LambdaSharp - Serverless .NET for AWS">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en_US">
    <meta property="og:url" content="https://lambdasharp.net/articles/ReleaseNotes-Damo.html">
    <meta property="og:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
    <meta property="og:description" content="Release notes for LambdaSharp &quot;Damo&quot; (v0.4)">
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LambdaSharp &quot;Damo&quot; Release (v0.4) | LambdaSharp - Serverless .NET for AWS">
    <meta name="twitter:site" content="@lambdasharp">
    <meta name="twitter:description" content="Release notes for LambdaSharp &quot;Damo&quot; (v0.4)">
    <meta name="twitter:image" content="https://lambdasharp.net/images/LambdaSharpBadge.png">
  
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
  
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:newtab" content="true">
  
    <title>LambdaSharp &quot;Damo&quot; Release (v0.4) | LambdaSharp - Serverless .NET for AWS </title>
    <link rel="canonical" href="https://lambdasharp.net/articles/ReleaseNotes-Damo.html">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/LambdaSharpLogo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="lambdasharp-damo-release-v0404---2019-01-11">LambdaSharp &quot;Damo&quot; Release (v0.4.0.4) - 2019-01-11</h1>

<blockquote>
<p>Damo was a Pythagorean philosopher said by many to have been the daughter of Pythagoras and Theano. <a href="https://en.wikipedia.org/wiki/Damo_(philosopher)">(Wikipedia)</a></p>
</blockquote>
<h2 id="whats-new">What's New</h2>
<p>The objective of the LambdaSharp 0.4 <em>Damo</em> release has been to enable LambdaSharp modules to be deployed to different tiers without requiring the module, or underlying code, to be rebuilt each time. To achieve this objective, all compile-time operations have been translated into equivalent CloudFormation operations that can be resolved at stack creation time. This change required adding support for <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">CloudFormation parameters</a>, which means that LambdaSharp modules can now be parameterized. For added convenience, LambdaSharp generates a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-interface.html">CloudFormation interface</a>, so that module parameters are laid out in a logical manner in the AWS Console.</p>
<p>In addition, LambdaSharp 0.4 <em>Damo</em> introduces a new module composition model that makes it easy to deploy modules that build on each other. A design challenge was to make this new composition model both easy to use while maintaining flexibility in how module dependencies are resolved. The solution leverages <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-stack-exports.html">CloudFormation exports</a> which provide built-in tracking of dependencies and termination protection. LambdaSharp cross-module references are automatically resolved by default, but can be overwritten when needed to reference other modules or use existing resources instead. The default behavior preserves the ease-of-use, while the flexibility of referencing different modules enables the freedom of choosing a preferred deployment topology. Finally, by allowing explicit resources names or values to be passed in, it is possible to deploy modules in legacy environments where resources were created through a different process.</p>
<p>Finally, LambdaSharp 0.4 <em>Damo</em> introduces a new core service--the <code>LambdaSharp Registrar</code>--that is responsible for registering modules and processing the CloudWatch Logs of their deployed Lambda functions. By monitoring the logs, <code>LambdaSharp Registrar</code> can automatically detect and report out-of-memory and timeout failures. As an extra bonus, <code>LambdaSharp Registrar</code> can optionally be integrated with <a href="http://rollbar.com">Rollbar</a> to create projects per module to track their warnings and errors.</p>
<h2 id="breaking-changes">BREAKING CHANGES</h2>
<p>The following change may impact modules created with previous releases.</p>
<h3 id="module-definition">Module Definition</h3>
<p>With the addition of new sections to the module definition, and with an eye towards the future, some attributes/sections have been renamed for consistency.</p>
<ul>
<li>The module name is now specified with the <code>Module</code> attribute (previously <code>Name</code>).</li>
<li>The function name is now specified with the <code>Function</code> attribute (previously <code>Name</code>).</li>
<li>Variables--formerly parameters--are now specified in the <code>Variables</code> section (previously <code>Parameters</code>). Similarly, for nested variables. The previous name was causing confusion with CloudFormation terminology.</li>
<li>Variables are no longer automatically added to function environments. Instead, the scope of a variable is controlled by the <code>Scope</code> attribute. The old behavior caused too many cases of circular dependencies, which were tedious to diagnose.</li>
<li>The variable name is now specified with the <code>Var</code> attribute (previously <code>Name</code>).</li>
<li>The <code>Export</code> attribute is no longer supported for variables and functions, because the AWS Parameter Store is no longer used for cross-module references.</li>
<li>The <code>Import</code> attribute is no longer supported for variables, because the AWS Parameter Store is no longer used for cross-module references.</li>
<li>The <code>Values</code> attribute has been removed since the <code>Value</code> attribute can now accept arbitrary expressions.</li>
<li>A package resource is now specified with the <code>Package</code> attribute, followed by its variable name.</li>
<li>The macro function source was replaced in favor of a macro definition in the <code>Outputs</code> section.</li>
</ul>
<h3 id="lambdasharp-tool">LambdaSharp Tool</h3>
<ul>
<li>The LambdaSharp Tool has been renamed to LambdaSharp CLI.</li>
<li>Function folders no longer need to be prefixed with the module name. They will still be found for backwards compatibility, but the new recommended naming is to just use the function name as the folder name.</li>
<li>With the introduction of <code>--cli-profile</code> there was the need to rename <code>--profile</code> to <code>--aws-profile</code> to avoid ambiguity.</li>
<li>The role of the pre-processor has been greatly reduced to make generated CloudFormation templates more portable. As such, support for variable substitutions using the moustache (<code>{{ }}</code>) notation has been removed. Conditional inclusion is still supported, but since it is done at the pre-processor level, the benefits are no longer available after the build phase is complete. To select which conditional inclusions to keep, use the new <code>--selector</code> option with the <code>build</code> command. For convenience, the <code>deploy</code> command defaults to using the <code>--tier</code> option value as selector, if no selector is provided. This makes running the <code>deploy</code> command very similar to what it was in the past.</li>
</ul>
<h3 id="lambdasharp-assemblies">LambdaSharp Assemblies</h3>
<ul>
<li>CloudFormation resources are now always resolved to the ARN of the created resource. Previously, created resources were resolved using the <code>!Ref</code> operation, which varies by resource type. This change was necessary to homogenize CloudFormation resources with resource references found in module parameters and cross-module references. For convenience, the <code>AwsConverters</code> class contains methods for extracting resource names from S3/SQS/DynamoDB/etc. ARNs.</li>
<li>The <code>ALambdaFunction&lt;TRequest&gt;</code> base class was removed in favor of <code>ALambdaFunction&lt;TRequest, TResponse&gt;</code>.</li>
</ul>
<h2 id="new-lambdasharp-cli-features">New LambdaSharp CLI Features</h2>
<h3 id="setup">Setup</h3>
<p>The LambdaSharp CLI is now a global dotnet tool, which makes it trivial to install. No more need to check-out the <a href="https://github.com/LambdaSharp/LambdaSharpTool">LambdaSharpTool GitHub repository</a> for creating modules unless to contribute to it.</p>
<pre><code class="lang-bash">dotnet tool install -g LambdaSharp.Tool --version 0.4.*
</code></pre>
<p>As part of the LambdaSharp CLI setup procedure, the CLI must be configured for the AWS account. The configuration step creates a profile and resources required to deploy LambdaSharp modules. The profile information is stored in the AWS Parameter Store so that it can be shared with team members. Multiple CLI profiles can be configured when needed.</p>
<pre><code class="lang-bash">dotnet lash config
</code></pre>
<p>Initializing a deployment tier has been streamlined into a single command, which deploys the LambdaSharp runtime modules from a public bucket. Alternatively, for LambdaSharp contributors, the CLI can deploy a locally compiled version of the LambdaSharp runtime modules.</p>
<pre><code class="lang-bash">dotnet lash init --tier Sandbox
</code></pre>
<p>For complete instructions and options, check out the updated <a href="Setup.html">setup documentation</a>.</p>
<h3 id="build-publish-and-deploy">Build, Publish, and Deploy</h3>
<p>The LambdaSharp deployment process has been broken down into three commands: <code>build</code>, <code>publish</code>, and <code>deploy</code>.</p>
<h4 id="build-command">Build Command</h4>
<p>The <code>build</code> command compiles the LambdaSharp module definition into a CloudFormation template, the functions into Lambda-ready packages, and compresses the file packages. The <code>build</code> command does not upload any assets and, therefore, does not require a LambdaSharp CLI profile, deployment tier, or even AWS account to work.</p>
<p>For .Net Core, before compiling the function projects, the LambdaSharp CLI verifies that the correct LambdaSharp assemblies are referenced. This ensures that LambdaSharp CLI produced CloudFormation template is compatible with the Lambda functions when they get deployed. In addition <code>dotnet restore</code> is run to ensure the latest dependencies are used.</p>
<p>To build the <code>Module.yml</code> file in the current folder:</p>
<pre><code class="lang-bash">dotnet lash build
</code></pre>
<p>To build the <code>Module.yml</code> file in another folder:</p>
<pre><code class="lang-bash">dotnet lash MyCompany/MyModule
</code></pre>
<h4 id="publish-command">Publish Command</h4>
<p>The <code>publish</code> command takes a path to a module manifest file as argument (e.g. <code>MyModule/bin/manifest.json</code>). The manifest is used to identify the module assets that must be uploaded to the deployment bucket associated with the LambdaSharp CLI profile. The <code>publish</code> command skips assets that have been previously uploaded and haven't changed.</p>
<p>If the <code>publish</code> command is used without referencing a module manifest file, it invokes the <code>build</code> command first.</p>
<p>To publish a previously built module:</p>
<pre><code class="lang-bash">dotnet lash publish MyCompany/MyModule/bin/manifest.json
</code></pre>
<h4 id="deploy-command">Deploy Command</h4>
<p>The <code>deploy</code> command takes a module name and version number as argument (e.g. <code>MyModule:1.0</code>) and attempts to locate a published module with the requested version number. The <code>deploy</code> command selects the latest compatible version for deployment. If the version is omitted or specified as <code>*</code>, the <code>deploy</code> command will use the latest version it can find.</p>
<p>If the <code>deploy</code> command is used with an argument that resolves a module file, it invokes the <code>build</code> and <code>publish</code> commands first. Similarly, if the argument resolves to a manifest file, the <code>deploy</code> command invokes the <code>publish</code> command first.</p>
<p>To deploy a published module:</p>
<pre><code class="lang-bash">dotnet lash deploy MyModule:1.0
</code></pre>
<p>To deploy a published module under an alternative name:</p>
<pre><code class="lang-bash">dotnet lash deploy --name MySpecialModule MyModule:1.0
</code></pre>
<p>To build, publish, and deploy the <code>Module.yml</code> file in the current folder:</p>
<pre><code class="lang-bash">dotnet lash deploy
</code></pre>
<p>To build, publish, and deploy the <code>Module.yml</code> file in another folder:</p>
<pre><code class="lang-bash">dotnet lash deploy MyCompany/MyModule
</code></pre>
<h5 id="module-parameters-processing">Module Parameters Processing</h5>
<p>The LambdaSharp CLI can be invoked with an optional inputs file to supply the module parameter values for the deployment.</p>
<pre><code class="lang-bash">dotnet lash deploy --inputs inputs.yml MyCompany/MyModule
</code></pre>
<p>The module parameters file is processed by the LambdaSharp CLI before being applied as follows:</p>
<ul>
<li>List of values are converted into a comma-separated text value.</li>
<li>The <code>Secrets</code> attribute is processed to resolve KMS key aliases into key ARNs for the deployment AWS account/region.</li>
</ul>
<p>For example, this parameters file:</p>
<pre><code class="lang-yaml">MyFirstParameter: 123
MySecondParameter:
  - abc
  - xyz
Secrets:
  - alias/MyDeveloperKey
  - alias/MyOtherKey
</code></pre>
<p>Is converted into these actual module parameter values:</p>
<pre><code class="lang-yaml">MyFirstParameter: 123
MySecondParameter: abc,xyz
Secrets: arn:aws:kms:us-east-1:123456789012:key/1234abcd-12ab-34cd-56ef-1234567890ab,arn:aws:kms:us-east-1:123456789012:key/abcd1234-12ab-34cd-56ef-1234567890ab
</code></pre>
<h5 id="pre-deployment-check">Pre-deployment Check</h5>
<p>The LambdaSharp CLI goes through a pre-deployment check before updating an existing CloudFormation stack:</p>
<ol>
<li>The module to be deploying and the deployed module names must match.</li>
<li>The module to be deployed must have the same or newer version than the deployed module.</li>
</ol>
<p>The pre-deployment check can be skipped with the <code>--force-deploy</code> option.</p>
<h3 id="other-cli-commands">Other CLI Commands</h3>
<h4 id="info-command">Info Command</h4>
<p>The <code>info</code> command was enhanced to show information about other installed tools that LambdaSharp CLI depends on, such as <code>dotnet</code> and <code>git</code>. In addition, sensitive information--like the AWS account ID--are hidden unless <code>--show-sensitive</code> option is used.</p>
<p>See the <a href="../cli/Tool-Info.html">updated documentation</a> for more details.</p>
<h4 id="encrypt-command">Encrypt Command</h4>
<p>The <code>encrypt</code> command was added to make it easier to encrypt sensitive information. The command can either use a specific KMS key or use the default KMS key for the deployment tier.</p>
<p>See the <a href="../cli/Tool-Encrypt.html">updated documentation</a> for more details.</p>
<h3 id="new-function-command">New Function Command</h3>
<p>The <code>new function</code> command now allows specifying the target language when adding a function.</p>
<p>See the <a href="../cli/Tool-New-Function.html">updated documentation</a> for more details.</p>
<h2 id="new-lambdasharp-module-features">New LambdaSharp Module Features</h2>
<h3 id="variables">Variables</h3>
<p>The <code>Variables</code> section defines literal values and resources. Variables can either be used to build other variables or passed into Lambda functions using the <code>Scope</code> attribute. Variables can define plaintext values, secrets, packages, or resources. When defining resources, variables can grant the module IAM role the permissions to act upon the resources.</p>
<p>To scope a variable to all functions, use the wildcard value (<code>*</code>):</p>
<pre><code class="lang-yaml">- Var: My Variable
  Scope: all
  Value: Best variable ever
</code></pre>
<p>To scope a variable to specific functions, list them by name:</p>
<pre><code class="lang-yaml">- Var: MyVariable
  Scope:
    - MyFirstFunction
    - MyOtherFunction
  Value: Another best variable!
</code></pre>
<h4 id="reusable-parameters-and-variables">Reusable Parameters and Variables</h4>
<p>LambdaSharp module parameters and variables can now be referenced by other variables and resource properties.</p>
<p>The following example shows how a variable can be used by another variable:</p>
<pre><code class="lang-yaml">- Var: Greeting
  Value: Hello

- Var: Message
  Value: !Sub &quot;${Greeting} World!&quot;
</code></pre>
<p>The same is also true for module parameters:</p>
<pre><code class="lang-yaml">- Parameter: Greeting
  Description: The greeting to use in the welcome message

# ...

- Var: Message
  Value: !Sub &quot;${Greeting} World!&quot;
</code></pre>
<p>Similarly, the <code>!Ref</code> expression can be used to reuse a variable or parameter.</p>
<pre><code class="lang-yaml">- Parameter: Topic

# ...

- Var: MyTopic
  Value: !Ref Topic
  Resource:
    Type: AWS::SNS::Topic
    Allow: Publish
</code></pre>
<p><strong>NOTE:</strong> the previous example is very common and LambdaSharp provides a shorthand notation for it.</p>
<pre><code class="lang-yaml">- Parameter: Topic
  Resource:
    Type: AWS::SNS::Topic
    Allow: Publish
</code></pre>
<h4 id="nested-variables">Nested Variables</h4>
<p>LambdaSharp module variables can be organized into hierarchies. The value of a nested variable is accessed by creating a path to it using a double-colon as separator (<code>::</code>).</p>
<pre><code class="lang-yaml">- Var: Greetings
  Variables:

    - Var: Coming
      Value: Hello

    - Var: Leaving
      Value: Bye

- Var: Message
  Value: !Sub &quot;${Greetings::Coming} World!&quot;
</code></pre>
<h4 id="default-variables">Default Variables</h4>
<p>Some module variables are always defined. These include:</p>
<ul>
<li><code>Module::Id</code>: the name of the deployed CloudFormation stack</li>
<li><code>Module::Name</code>:  the name of the module</li>
<li><code>Module::Version</code>: the version of the module</li>
<li><code>Module::DeadLetterQueueArn</code>: the default dead-letter queue</li>
<li><code>Module::LoggingStreamArn</code>: the default function logging stream</li>
<li><code>Module::DefaultSecretKeyArn</code>: the default secret encryption key</li>
</ul>
<p>The built-in variables can be accessed like other variables:</p>
<pre><code class="lang-yaml">- Var: UseBuiltInVariable
  Value: !Ref Module::Version

- Var: InlineBuiltInVariables
  Value: !Sub &quot;${Module::Name} (v${Module::Version})&quot;
</code></pre>
<h3 id="module-inputs">Module Inputs</h3>
<p>LambdaSharp modules can now define parameters and imports (a.k.a. cross-module references) in the <a href="../syntax/Module-Parameter.html"><code>Inputs</code> section</a>.</p>
<h4 id="module-parameters">Module Parameters</h4>
<p>LambdaSharp module parameters are modelled after <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">CloudFormation parameters</a> and support all of their attributes. See the <a href="../syntax/Module-Parameter.html">parameters documentation</a> for more details.</p>
<p>In addition, a LambdaSharp module parameter can associate IAM permission with its parameter value, similar to variables.</p>
<pre><code class="lang-yaml">- Parameter: Topic
  Resource:
    Type: AWS::SNS::Topic
    Allow: Publish
</code></pre>
<p>This concept is taken one step further with conditional resources, which are only created when the module parameter is set to its default value. Otherwise the provided parameter value is used. In either case, the resource is associated with the requested IAM permissions.</p>
<pre><code class="lang-yaml">- Parameter: Topic
  Description: Provide the ARN for an existing topic or leave blank to create a new one.
  Default: &quot;&quot;
  Resource:
    Type: AWS::SNS::Topic
    Allow: Publish
    Properties:
      DisplayName: My Topic
</code></pre>
<p><strong>NOTE:</strong> the <code>Properties</code> section is ignored if a non-default parameter value is used since no resource is being created.</p>
<h4 id="module-secret-parameters">Module Secret Parameters</h4>
<p>In addition to the default CloudFormation parameter types, LambdaSharp modules can have parameters of type <code>Secret</code>. A secret parameter is passed in as base64-encoded string of the encrypted data (see <a href="../cli/Tool-Encrypt.html">CLI <code>encrypt</code> command</a>). To be able to decrypt the data, the KMS key must either be listed in the <code>Secrets</code> section or be passed in the <code>Secrets</code> parameter. Encrypted parameter values remain encrypted through the deployment process and are only decrypted in memory by the functions when accessed during initialization.</p>
<pre><code class="lang-yaml">- Parameter: MyApiKey
  Type: Secret
</code></pre>
<h4 id="module-imports-aka-cross-module-references">Module Imports (a.k.a. Cross-Module References)</h4>
<p>LambdaSharp module imports enable a module to reference output values from another module. This mechanism is also known as <em>cross-module references</em>. Cross-module references are implemented using CloudFormation parameters, conditionals, exports, and the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-importvalue.html"><code>!ImportValue</code> function</a> to reference them. The complexity of cross-module references implementation is hidden behind a usage mechanism consistent with module parameters and variables.</p>
<p>The LambdaSharp implementation of cross-module references enables CloudFormation to resolve references at deployment time. However, they can also be redirected to a different module output value or be given an specific value instead. This capability makes it possible to have a default behavior that is mostly convenient, while enabling modules to be re-wired to import parameters from other modules, or to be given existing values for testing or legacy purposes.</p>
<pre><code class="lang-yaml">- Import: MyOtherModule::Topic
  Scope: all
  Description: Topic ARN for notifying users

# ...

- Var: MyTopic
  Value: !Ref MyOtherModule::Topic
</code></pre>
<p>The default value for the module import is <code>$MyOtherModule::Topic</code>, which instructs CloudFormation to translate the module import to <code>!ImportValue &quot;MyOtherModule::Topic&quot;</code> (<strong>NOTE:</strong> deployment prefix was omitted for brevity). Setting the import value to <code>$SomeModule::OtherTopic</code> instructs CloudFormation to translate the module import to <code>!ImportValue &quot;SomeModule::OtherTopic&quot;</code> instead. Alternatively, the import value could be set to an existing resource ARN, suh as <code>arn:aws:sns:use-east-1:123456789012:ExistingTopic</code>. In this case, CloudFormation will use the ARN directly without using <code>!ImportValue</code>.</p>
<p>Furthermore, module imports can associate IAM permissions to the import value.</p>
<pre><code class="lang-yaml">- Import: MyOtherModule::Topic
  Resource:
    Type: AWS::SNS::Topic
    Allow: Publish
</code></pre>
<p>See module imports documentation for more details.</p>
<h4 id="cloudformation-interface">CloudFormation Interface</h4>
<p>Module parameters and imports can be modified when updating a CloudFormation stack. By default, the module parameters and imports are shown using labels derived from their names in a section labeled <em>Module Settings</em>. The automatically generated labels insert spaces between lowercase characters/digits and uppercase characters (e.g. <code>MyParameterValue</code> becomes <code>My Parameter Value</code>). However, parameters and imports can be organized into custom sections by using the <code>Section</code> attribute with a custom label using the <code>Label</code> attribute. Sections and labels are useful to make configuring modules post-deployment more user friendly.</p>
<pre><code class="lang-yaml">- Parameter: MyParameter
  Section: My Module Settings
  Label: My Favorite Parameter # (automatic label would have been &quot;My Parameter&quot;)
</code></pre>
<h3 id="module-outputs">Module Outputs</h3>
<p>LambdaSharp modules can have three kinds of outputs: exports, custom resources, and macros.</p>
<p>Module exports are converted into <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-stack-exports.html">CloudFormation export</a> values for top-level stacks. For nested stacks, the module exports are converted into CloudFormation stack outputs. This behavior prevents other modules from taking dependencies on nested stacks.</p>
<pre><code class="lang-yaml">- Var: MyQueue
  Resource:
    Type: AWS::SQS::Queue
    Allow: Send

# ...

- Export: QueueArn
  Description:
  Value: !GetAtt MyQueue.Arn
</code></pre>
<p>See module exports documentation for more details.</p>
<p>Custom resource definitions create new types of resources that can be used by other modules. Custom resources are a powerful way to expand the capabilities of modules beyond those provided by CloudFormation.</p>
<pre><code class="lang-yaml">- CustomResource: Accounting::Report
  Description: Custom resource type for creating accounting reports
  Handler: AccountReportGenerator

# ...

- Function: AccountReportGenerator
  Memory: 128
  Timeout: 30
  Sources:
    - Topic: AccountReportGeneratorTopic
</code></pre>
<p>See custom resource documentation for more details.</p>
<p>A macro definition creates a CloudFormation macro for the deployment tier. The handler must be a Lambda function. Once deployed, the macro is available to all subsequent module deployments.</p>
<pre><code class="lang-yaml">- Macro: ToUpper
  Description: CloudFormation macro for converting a string to uppercase
  Handler: StringOpFunction

- Macro: ToLower
  Description: CloudFormation macro for converting a string to uppercase
  Handler: StringOpFunction

# ...

- Function: StringOpFunction
  Memory: 128
  Timeout: 15
</code></pre>
<p>See <a href="../syntax/Module-Macro.html">macro documentation</a> for more details.</p>
<h3 id="misc">Misc</h3>
<h4 id="alexa-source">Alexa Source</h4>
<p>The Alexa source definition now allows expressions when setting the Alexa Skill ID.</p>
<pre><code class="lang-yaml">- Parameter: AlexaSkillId
  Default: &quot;*&quot;

# ...

- Function: Function
  Memory: 128
  Timeout: 30
  Sources:
    - Alexa: !Ref AlexaSkillId
</code></pre>
<h2 id="new-lambdasharp-runtime-features">New LambdaSharp Runtime Features</h2>
<p>The LambdaSharp runtime is now a top-level CloudFormation stack with supporting modules deployed as nested stacks.</p>
<h3 id="lambdasharp-registrar">LambdaSharp Registrar</h3>
<p>The newest runtime module is the <code>Registrar</code>, which is responsible for registering modules and functions. Upon registration, function logs are centrally processed to detect warnings and errors.</p>
<p>The <code>Registrar</code> can optionally be configured to integrate with <a href="https://rollbar.com">Rollbar</a> to create tracking projects on module deployment.</p>
<p>See the LambdaSharp CLI &amp; Runtime documentation for more details.</p>
<h2 id="new-lambdasharp-assembly-features">New LambdaSharp Assembly Features</h2>
<h3 id="alambdafunction-class">ALambdaFunction Class</h3>
<p>The following methods were added to the <code>ALambdaFunction</code> abstract, base class:</p>
<ul>
<li><code>string DecryptSecretAsync(string secret, Dictionary&lt;string, string&gt; encryptionContext = null)</code><br>
This method decrypts a base64-encoded string value.</li>
<li><code>string EncryptSecretAsync(string text, string encryptionKeyId = null, Dictionary&lt;string, string&gt; encryptionContext = null)</code><br>
This method encrypt a string into a base64-encoded string. By default, the method uses the <code>DefaultSecretKeyArn</code> KMS key to encrypt the string.</li>
<li><code>T T DeserializeJson&lt;T&gt;(Stream stream)</code><br>
This method deserializes a stream using the built-in AWS Lambda .Net SDK JSON deserializer.</li>
<li><code>T DeserializeJson&lt;T&gt;(string json)</code><br>
This method deserializes a string using the built-in AWS Lambda .Net SDK JSON deserializer.</li>
<li><code>string SerializeJson(object value)</code><br>
This method serializes an object into a JSON string using the built-in AWS Lambda .Net SDK JSON deserializer.</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>The <code>${Tier}-</code> expression has been replaced with <code>${DeploymentPrefix}</code> in CloudFormation templates.</li>
<li>Lambda CloudWatch Logs are now configured to self-delete log stream entries after seven (7) days. In addition, the log group is now deleted when the function is deleted during module tear-down.</li>
</ul>
<h2 id="fixes">Fixes</h2>
<h3 id="v0404---2019-01-11">(v0.4.0.4) - 2019-01-11</h3>
<ul>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/82">Fixed LambdaSharp modules are always installed from public lambdasharp bucket</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/83">Fixed documentation error that showed wrong keyword for subscribing a function to a topic</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/84">Fixed cannot unzip package from deployment bucket when S3PackageLoader is installed from the global lambdasharp bucket</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/85">Fixed error when creating a resource with custom resource type</a></li>
</ul>
<h3 id="v0403---2018-12-16">(v0.4.0.3) - 2018-12-16</h3>
<ul>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/77">Fixed when Fn::Join always used &quot;,&quot; to join items, no matter what separator was given</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/78">Fixed VersionInfo <code>operator !=</code> (not equal) returned <code>false</code> when the references were not equal</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/79">Fixed reference resolver sometimes failing to recognize legal expressions</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/80">Fixed invalid wildcard assembly reference in generated .csproj file</a></li>
</ul>
<h3 id="v0402---2018-11-13">(v0.4.0.2) - 2018-11-13</h3>
<ul>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/60">Fixed issue where LambdaSharp bucket discovery incorrectly defaulted back to the original bucket during deployment.</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/61">Fixed issue where AWS profile was only set via <code>AWS_PROFILE</code> environment variable. Now <code>AWS_DEFAULT_PROFILE</code> is also set.</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/62">Fixed issue where <code>config</code> did not default to <code>LAMBDASHARP_PROFILE</code> value when configuring a new CLI profile.</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/63">Fixed issue where LambdaSharp Runtime module used a multi-region domain name pattern for S3 buckets that was incompatible with the <code>us-east-1</code> region.</a></li>
</ul>
<h3 id="v0401---2018-11-12">(v0.4.0.1) - 2018-11-12</h3>
<ul>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/57">Fixed an issue where file packages did not get the correct name.</a></li>
<li><a href="https://github.com/LambdaSharp/LambdaSharpTool/issues/58">Fixed an issue where function could not be referenced by CloudFormation expressions (e.g. <code>!Ref</code>).</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
